# Import the built-in socket and time modules
import socket
import time

var battery = 100

# IP and port of Tello
tello_address = ('192.168.10.1', 8889)

# Create a UDP connection that we'll send the command to
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# Let's be explicit and bind to a local port on our machine where Tello can send messages
sock.bind(('192.168.10.2', 9000))

# Function to send messages to Tello
def send(message):
  try:
    sock.sendto(message.encode(), tello_address)
    print("Sending message: " + message)
  except Exception as e:
    print("Error sending: " + str(e))

# Function that listens for messages from Tello and prints them to the screen
def receive():
  try:
    response, ip_address = sock.recvfrom(128)
    print("Received message: " + response.decode(encoding='utf-8') + " from Tello with IP: " + str(ip_address))
  except Exception as e:
    print("Error receiving: " + str(e))

def check
 # Ask Tello about battery status
send("battery?")

# Receive battery response from Tello
receive()

if battery == 20

then 
break
emergency
print("plz replace battery")   


# Ask Tello about battery status
send("baro?")

# Receive battery response from Tello
receive()

if baro == range(100-110)
 break 
  back 20
  land 
  
  # Ask Tello about battery status
send("time?")

# Receive battery response from Tello
receive()

if time == 180
 break 
  back 20
  land 


# Send Tello into command mode
send("command")

# Receive response from Tello
receive()

# Delay 3 seconds before we send the next command
time.sleep(1)

# Ask Tello about battery status
send("battery?")

# Receive battery response from Tello
receive()

if battery = 20

then emergency
print("plz replace battery")


time.sleep(1)

send("takeoff")
time.sleep(5)

def.check

send("forward 400")
time.sleep(2)

def.check

send("up 160")
time.sleep(1)

def.check

send("cw 50")
time.sleep(1)

def.check

send("forward 500")
time.sleep(2)

def.check

send("cw 200")
time.sleep(1)

send("down 150")
time.sleep(2)

def.check

send("forward 300")
send("cw 300")
send("up 10")
time.sleep(2)

def.check

send("forward 200")
send("cw 400")
send("up 210")
time.sleep(2)

def.check

send("back 200")
send("cw 200")

def.check

send("cw 50")
send("down 195")

def.check

send("forward 500")

send("land")
time.sleep(10)

# Close the UDP socket
sock.close()
